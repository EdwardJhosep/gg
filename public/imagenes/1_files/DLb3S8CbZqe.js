;/*FB_PKG_DELIM*/

__d("useMAWMediaDownloadStatus",["react","useMAWBulkMediaDownloadStatus"],(function(a,b,c,d,e,f,g){"use strict";var h;b=h||d("react");b.useMemo;var i=b.c;function a(a,b,d){var e=i(4);if(e[0]!==a||e[1]!==d||e[2]!==b){var f;f=a!=null?[{attachment:a,mediaRenderQpl:b,statusKey:(f=d)!=null?f:a.attachmentFbid}]:[];e[0]=a;e[1]=d;e[2]=b;e[3]=f}else f=e[3];a=f;d=a;b=c("useMAWBulkMediaDownloadStatus")(d);return b.length>0?b[0]:null}g["default"]=a}),98);
__d("useMAWMaybeAutoTriggerDownload",["MAWDownloadMediaInWorkerDeferred","MAWGetIsMediaDownloadStatusEnabled","MAWIsXMAWithPlaintextHash","MAWMediaDownloadStatus","MAWRetryReceiverFetchSticker","MAWStateContext.react","WAHashUtils","isReceiverFetchSticker","react","useAsyncReStore","useMAWMediaDownloadStatus","usePrevious"],(function(a,b,c,d,e,f,g){"use strict";var h;b=h||d("react");var i=b.useContext,j=b.useEffect,k=b.useState,l=b.c;function a(a,b,e,f){var g=l(23),h=c("useMAWMediaDownloadStatus")(a,b,f),m;g[0]!==a?(m=c("isReceiverFetchSticker")(a),g[0]=a,g[1]=m):m=g[1];var n=m,o=(h==null?void 0:(m=h.status)==null?void 0:m.mainMediaStatus)===c("MAWMediaDownloadStatus").MISSING_FILE||(h==null?void 0:(m=h.status)==null?void 0:m.mainMediaStatus)===c("MAWMediaDownloadStatus").MANUAL_RETRYABLE_FAILURE;h=c("usePrevious")(o);m=k(!1);var p=m[0],q=m[1],r=i(d("MAWStateContext.react").MAWDispatchContext),s=c("useAsyncReStore")();g[2]!==o||g[3]!==p||g[4]!==n||g[5]!==s||g[6]!==a||g[7]!==r||g[8]!==b||g[9]!==f||g[10]!==e?(m=function(){o&&p===!1&&(q(!0),n?d("MAWRetryReceiverFetchSticker").retryReceiverFetchSticker(s,a,r,b):d("MAWIsXMAWithPlaintextHash").isXMAWithPlaintextHash(a)&&d("MAWGetIsMediaDownloadStatusEnabled").getIsMediaDownloadStatusForXMAsEnabled()?d("MAWDownloadMediaInWorkerDeferred").maybeDownloadMediaInWorkerWithPlaintextHash({attachment:a,dispatch:r,mediaRenderQpl:b,plaintextHash:f!=null?d("WAHashUtils").stringToPlaintextHash(f):void 0,triggerUIView:e}):d("MAWDownloadMediaInWorkerDeferred").maybeDownloadMediaInWorker({attachment:a,dispatch:r,mediaRenderQpl:b,triggerUIView:e}))},g[2]=o,g[3]=p,g[4]=n,g[5]=s,g[6]=a,g[7]=r,g[8]=b,g[9]=f,g[10]=e,g[11]=m):m=g[11];var t;g[12]!==a||g[13]!==b||g[14]!==o||g[15]!==h||g[16]!==e||g[17]!==r||g[18]!==p||g[19]!==n||g[20]!==s||g[21]!==f?(t=[a,b,o,h,e,r,q,p,n,s,f],g[12]=a,g[13]=b,g[14]=o,g[15]=h,g[16]=e,g[17]=r,g[18]=p,g[19]=n,g[20]=s,g[21]=f,g[22]=t):t=g[22];j(m,t)}g["default"]=a}),98);
__d("MAWAttachmentStateHandlerContentBase.react",["FBLogger","MAWMediaDownloadStatusUIStateType","react","useMAWBulkMediaDownloadManualRetry","useMAWMaybeAutoTriggerDownload","useMAWMediaDownloadStatus","useMAWMediaStatusUIState"],(function(a,b,c,d,e,f,g){"use strict";var h,i;b=i||d("react");h||(h=c("react"));var j=b.useEffect,k=b.useMemo;function a(a){var b=a.attachmentsFromGroupToRetry,e=a.dbAttachment,f=a.descriptionForLogging,g=a.downloadStatusKeyOverride,h=a.errorComponentRenderer,i=a.errorWithBlurComponentRenderer,l=a.loadingPlaceholderRenderer,m=a.mediaRenderQpl;a=a.successfulComponentRenderer;var n=k(function(){return b!=null&&b.length>0?b:[e]},[e,b]);n=c("useMAWBulkMediaDownloadManualRetry")(n,m);var o=c("useMAWMediaStatusUIState")(e,m,g),p=o.downloadStatus;o=(o=c("useMAWMediaDownloadStatus")(e,m,g))!=null?o:{};var q=o.status;c("useMAWMaybeAutoTriggerDownload")(e,m,"thread",g);j(function(){var a,b={string:{call_site:f,download_status_main_details:q==null?void 0:q.mainMediaStatusDetails,download_status_main_media:String(q==null?void 0:q.mainMediaStatus),download_status_preview_details:q==null?void 0:q.previewMediaStatusDetails,download_status_preview_media:String(q==null?void 0:q.previewMediaStatus),download_status_ui_state:p}};m==null?void 0:m.addPoint("render-attachment-state-handler-content-wrapper-"+((a=p)!=null?a:"null"),b)},[m,p,q==null?void 0:q.mainMediaStatusDetails,q==null?void 0:q.mainMediaStatus,q==null?void 0:q.previewMediaStatusDetails,q==null?void 0:q.previewMediaStatus,f]);j(function(){switch(p){case"non_retryable_error":case"retryable_error":case"non_retryable_error_with_preview":case"retryable_error_with_preview":Boolean(q==null?void 0:q.mainMediaStatusDetails)?m==null?void 0:m.endFail(p+": "+(q==null?void 0:q.mainMediaStatusDetails)):m==null?void 0:m.endFail(p);break;case null:case"downloaded":case"loading":break;default:m==null?void 0:m.endFail("unknown_state",{string:{unknown_state_value:p}});break}},[m,p,f]);o=d("MAWMediaDownloadStatusUIStateType").isRetryableErrorState(p);switch(p){case null:case"loading":return l(f+".MAWAttachmentStateHandlerContentBase.NoMedia",!1);case"non_retryable_error":case"retryable_error":return h(o,n);case"non_retryable_error_with_preview":case"retryable_error_with_preview":return i==null?h(o,n):i(o,n);case"downloaded":return a(l);default:c("FBLogger")("messenger_web_media").mustfix("[MAW Attachment Content] Unknown MediaDownloadStatusUIState %s",p);return l(f+".MAWAttachmentStateHandlerContentBase.UnknownState",!1)}}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MAWCutoverQPLLogger",["QPLUserFlow","qpl"],(function(a,b,c,d,e,f,g){"use strict";var h={instanceKey:0,isInProgress:!1};function a(a){h.isInProgress&&c("QPLUserFlow").endCancel(c("qpl")._(1056840990,"2431"),{instanceKey:h.instanceKey});c("QPLUserFlow").start(c("qpl")._(1056840990,"2431"),{annotations:{bool:{is_dtc:a}},instanceKey:++h.instanceKey,timeoutInMs:1e4});h.isInProgress=!0;return h.instanceKey}function b(a,b,d){if(a==null)return;c("QPLUserFlow").addPoint(c("qpl")._(1056840990,"2431"),b,babelHelpers["extends"]({instanceKey:a},d))}function d(a,b){if(a==null)return;c("QPLUserFlow").addAnnotations(c("qpl")._(1056840990,"2431"),b,{instanceKey:a})}function e(a){if(a==null)return;h.isInProgress=!1;c("QPLUserFlow").endSuccess(c("qpl")._(1056840990,"2431"),{instanceKey:a})}function f(a,b){if(a==null)return;c("QPLUserFlow").endFailure(c("qpl")._(1056840990,"2431"),b,{instanceKey:a})}g.startQpl=a;g.addPoint=b;g.addAnnotations=d;g.endSuccess=e;g.endFailure=f}),98);
__d("MAWThreadViewAttachmentStateHandlerContent.react",["CometHeroHoldTrigger.react","MAWAttachmentStateHandlerContentBase.react","MWV2AttachmentLoadingPlaceholder.react","react"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=(i||d("react")).c,k=h||(h=c("react"));function a(a){var b=j(21),d=a.attachmentsFromGroupToRetry,e=a.connectBottom,f=a.connectTop,g=a.dbAttachment,h=a.descriptionForLogging,i=a.downloadStatusKeyOverride,l=a.errorComponentRenderer,m=a.errorWithBlurComponentRenderer,n=a.loadingPlaceholderStyle,o=a.mediaRenderQpl,p=a.outgoing,q=a.placeholderHeight,r=a.placeholderMaxHeight,s=a.placeholderMaxWidth,t=a.placeholderWidth;a=a.successfulComponentRenderer;h=h+".MAWThreadViewAttachmentStateHandlerContent";var u;b[0]!==e||b[1]!==f||b[2]!==g||b[3]!==q||b[4]!==r||b[5]!==s||b[6]!==t||b[7]!==o||b[8]!==p||b[9]!==n?(u=function(a,b){var d;return k.jsxs(k.Fragment,{children:[k.jsx(c("MWV2AttachmentLoadingPlaceholder.react"),{connectBottom:e,connectTop:f,descriptionForLogging:a,hasAppAttribution:(g==null?void 0:g.attributionAppName)!=null,height:q,maxHeight:(d=r)!=null?d:q,maxWidth:(d=s)!=null?d:t,mediaRenderQpl:o,outgoing:p,width:t,xstyle:n}),!b&&k.jsx(c("CometHeroHoldTrigger.react"),{description:a,hold:!0})]})},b[0]=e,b[1]=f,b[2]=g,b[3]=q,b[4]=r,b[5]=s,b[6]=t,b[7]=o,b[8]=p,b[9]=n,b[10]=u):u=b[10];var v;b[11]!==d||b[12]!==g||b[13]!==h||b[14]!==i||b[15]!==l||b[16]!==m||b[17]!==u||b[18]!==o||b[19]!==a?(v=k.jsx(c("MAWAttachmentStateHandlerContentBase.react"),{attachmentsFromGroupToRetry:d,dbAttachment:g,descriptionForLogging:h,downloadStatusKeyOverride:i,errorComponentRenderer:l,errorWithBlurComponentRenderer:m,loadingPlaceholderRenderer:u,mediaRenderQpl:o,successfulComponentRenderer:a}),b[11]=d,b[12]=g,b[13]=h,b[14]=i,b[15]=l,b[16]=m,b[17]=u,b[18]=o,b[19]=a,b[20]=v):v=b[20];return v}g["default"]=a}),98);
__d("MWOptimisticSecureThreadPreview.react",["CometPlaceholder.react","CometProgressRingIndeterminate.react","I64","LSIntEnum","LSSearchType","LSThreadAttributionStore","MWComposerGating.react","MWOpenAndSecureThreadView.react","MWPThreadPreview.react","MWPThreadThemeProvider.react","MWRelayChatTabHeaderRoot.react","MWV2TabContainer","ReQL","ReQLSuspense","react","useMWChatStateUpdateThreadKeyDescriptorIfAuthoritative","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j,k,l=k||(k=d("react"));b=k;var m=b.useEffect;b.useMemo;var n=b.useState,o=b.c;function a(a){var b=o(25),e=a.otherContactIdForOptimisticSecureThread;a=a.tab;var g=(h||(h=c("useReStore")))(),k,q;b[0]!==e||b[1]!==g?(k=function(){return e==null?d("ReQL").empty():d("ReQL").fromTableAscending(g.tables.contacts,["blockedByViewerStatus","name","profilePictureUrl","id"]).getKeyRange(e)},q=[g,e],b[0]=e,b[1]=g,b[2]=k,b[3]=q):(k=b[2],q=b[3]);k=d("ReQLSuspense").useFirst(k,q,f.id+":55");q=n();var r=q[0];q=q[1];var s;b[4]===Symbol["for"]("react.memo_cache_sentinel")?(s={shouldClearOldHiddenTab:!1,shouldUpdateThreadType:!1},b[4]=s):s=b[4];c("useMWChatStateUpdateThreadKeyDescriptorIfAuthoritative")(r,a,s);var t=r==null?void 0:r.threadKey,u;b[5]!==t||b[6]!==e?(s=function(){if(t==null||e==null)return;var a=d("LSThreadAttributionStore").getSource(void 0,(i||(i=d("I64"))).to_string(e));a.value!=="unknown"&&(a.type==="LSThreadAttribution"?d("LSThreadAttributionStore").setLSMessagingThreadAttribution((i||(i=d("I64"))).to_string(t),i.to_string(a.value)):d("LSThreadAttributionStore").setSource((i||(i=d("I64"))).to_string(t),a.value))},u=[t,e],b[5]=t,b[6]=e,b[7]=s,b[8]=u):(s=b[7],u=b[8]);m(s,u);b[9]===Symbol["for"]("react.memo_cache_sentinel")?(s=l.jsx("div",{className:"x6s0dn4 x78zum5 x1iyjqo2 xl56j7k",children:l.jsx(c("CometProgressRingIndeterminate.react"),{color:"disabled_DEPRECATED",size:24})}),b[9]=s):s=b[9];u=s;if(b[10]!==r){s=r!=null&&l.jsx(c("CometPlaceholder.react"),{fallback:null,name:"MWDefaultE2eeThreadPreview.Composer",children:l.jsx(c("MWPThreadThemeProvider.react"),{themeFbid:r.themeFbid,children:l.jsx(d("MWComposerGating.react").MWChatComposerGating,{isPreviewThread:!0,thread:r},(i||(i=d("I64"))).to_string((s=r.clientThreadKey)!=null?s:r.threadKey))})});b[10]=r;b[11]=s}else s=b[11];s=s;var v;b[12]!==k?(v=k!=null?[{blockedByViewerStatus:k.blockedByViewerStatus,contextLine:"",displayName:k.name,id:k.id,profilePicUrl:k.profilePictureUrl,threadType:(j||(j=d("LSIntEnum"))).ofNumber(15),type_:(j||(j=d("LSIntEnum"))).ofNumber(c("LSSearchType").CONTACT)}]:[],b[12]=k,b[13]=v):v=b[13];k=v;v=k;k=(k=r==null?void 0:r.threadKey)!=null?k:void 0;var w;b[14]!==r||b[15]!==a?(w=r&&l.jsx(c("MWRelayChatTabHeaderRoot.react"),{tab:a,threadKey:r.threadKey}),b[14]=r,b[15]=a,b[16]=w):w=b[16];b[17]!==v||b[18]!==s?(r=l.jsx(c("CometPlaceholder.react"),{fallback:null,name:"MWDefaultE2eeThreadPreview.ThreadPreview",children:l.jsx(c("MWPThreadPreview.react"),{areWeCreatingASecureThread:!0,nullstate:u,renderThreadView:p,setPreviewThread:q,tokens:v,children:s})}),b[17]=v,b[18]=s,b[19]=r):r=b[19];b[20]!==a||b[21]!==k||b[22]!==w||b[23]!==r?(u=l.jsxs(c("MWV2TabContainer"),{tab:a,threadKey:k,children:[w,r]}),b[20]=a,b[21]=k,b[22]=w,b[23]=r,b[24]=u):u=b[24];return u}function p(a){return l.jsx(c("MWOpenAndSecureThreadView.react"),{thread:a})}p.displayName=p.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("useMWPThreadPointQueryOneToOneCutoverThreadThenNavigate",["I64","LSFactory","LSPlatformWaitForTaskCompletion","LSThreadAttributionStore","LSThreadPointQueryAndRestoreMessagesWithJIDStoredProcedure","MAWCutoverQPLLogger","MAWJids","QPLUserFlow","ReQL","WABridgedAPI","WALoggerDeferred","asyncToGeneratorRuntime","justknobx","promiseDone","qpl","react","useAsyncReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i;function j(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);j=function(){return a};return a}function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["[Thread-Point-Query][OD-Cutover] LSThreadPointQueryAndRestoreMessagesWithJID finished successfully for ThreadKey: ",""]);k=function(){return a};return a}var l=(h||d("react")).useCallback,m=c("justknobx")._("2707");function a(){var a=c("useAsyncReStore")();return l(function(e){var f=e.contactId,g=e.isOnDemandCutover,h=e.navigationApi,l=e.qplInstanceKey;d("MAWCutoverQPLLogger").addPoint(l,"tpq_then_navigate_started");c("promiseDone")(a,function(){var a=b("asyncToGeneratorRuntime").asyncToGenerator(function*(a){function e(a,b){var e=a.clientThreadKey,g=a.threadKey;a=a.threadType;c("promiseDone")(c("WABridgedAPI").getDevices({ignoreDhash:!1,reason:"thread-point-querying-1-to-1-thread",users:new Set().add(d("MAWJids").toUserJid((i||(i=d("I64"))).to_string(f)))}));d("MAWCutoverQPLLogger").addPoint(l,"navigate_to_thread");d("MAWCutoverQPLLogger").endSuccess(l);h.openTabOrInbox({clientThreadKey:e,threadKey:g,threadType:a},(e=b)!=null?e:"preCutoverThread",void 0,void 0,{subEntrypoint:"threadPointQuery1To1"})}var o=d("ReQL").fromTableAscending(a.tables.mi_act_mapping_table.index("jid")).getKeyRange(f);if(m){var p=(yield d("ReQL").firstAsync(o));d("MAWCutoverQPLLogger").addPoint(l,"check_existing_mapping");d("MAWCutoverQPLLogger").addAnnotations(l,{bool:{has_mi_act_mapping:p!=null}});p=p!=null?yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.threads).getKeyRange(p.serverThreadKey)):null;if(p!=null)if(g===!0){var q=n(f,p.threadKey);e(p,q)}else e(p)}o.subscribe(function(){var c=b("asyncToGeneratorRuntime").asyncToGenerator(function*(b,c){b=c.operation;if(b==="delete")return;d("MAWCutoverQPLLogger").addPoint(l,"mi_act_mapping_table_updated");c=(yield d("ReQL").firstAsync(o));if(c==null)return;d("MAWCutoverQPLLogger").addPoint(l,"mi_act_mapping_table_non_null");b=(yield d("ReQL").firstAsync(d("ReQL").fromTableAscending(a.tables.threads).getKeyRange(c.serverThreadKey)));if(b==null)return;d("MAWCutoverQPLLogger").addPoint(l,"thread_non_null");if(g===!0){c=n(f,b.threadKey);e(b,c)}else e(b)});return function(a,b){return c.apply(this,arguments)}}());d("MAWCutoverQPLLogger").addPoint(l,"thread_point_query_started");c("LSPlatformWaitForTaskCompletion")(a,function(a){return c("LSThreadPointQueryAndRestoreMessagesWithJIDStoredProcedure")(c("LSFactory")(a),{waJid:f})},"readwrite").then(function(){d("MAWCutoverQPLLogger").addPoint(l,"thread_point_query_succeeded"),c("promiseDone")(d("WALoggerDeferred").LOG(k(),(i||(i=d("I64"))).to_string(f))),g===!0&&c("QPLUserFlow").endSuccess(c("qpl")._(1056847893,"505"))})["catch"](function(a){d("MAWCutoverQPLLogger").endFailure(l,"TPQFailure");a="[Thread-Point-Query][OD-Cutover] LSThreadPointQueryAndRestoreMessagesWithJID finished with an error for ThreadKey: "+(i||(i=d("I64"))).to_string(f)+"\nError: "+a;c("promiseDone")(d("WALoggerDeferred").LOG(j(),a));g===!0&&c("QPLUserFlow").endFailure(c("qpl")._(1056847893,"505"),a)})});return function(b){return a.apply(this,arguments)}}())},[a])}function n(a,b){var c=d("LSThreadAttributionStore").getSource(void 0,(i||(i=d("I64"))).to_string(b));if(c.type==="MWLSEntrypoint"&&c.value!=="unknown")return c.value;c=d("LSThreadAttributionStore").getSource(void 0,i.to_string(a));if(c.type==="MWLSEntrypoint"&&c.value!=="unknown"){d("LSThreadAttributionStore").setSource((i||(i=d("I64"))).to_string(b),c.value);return c.value}return void 0}g["default"]=a}),98);
__d("useMAWTriggerOnDemandCutover",["I64","Int64Hooks","LSFactory","LSPlatformWaitForTaskCompletion","LSThreadPointQueryAndRestoreMessagesWithJIDStoredProcedure","QPLUserFlow","WALoggerDeferred","gkx","promiseDone","qpl","react","useMAWCanThreadBeCutoverOnDemand","useMWNavigation","useMWPThreadPointQueryOneToOneCutoverThreadThenNavigate","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j;function k(){var a=babelHelpers.taggedTemplateLiteralLoose(["",""]);k=function(){return a};return a}function l(){var a=babelHelpers.taggedTemplateLiteralLoose(["[OD-Cutover] Cutover finished successfully for ThreadKey: ",""]);l=function(){return a};return a}function m(){var a=babelHelpers.taggedTemplateLiteralLoose(["[OD-Cutover] Triggering cutover for ThreadKey: ",""]);m=function(){return a};return a}b=j||d("react");var n=b.useRef,o=b.useState;function a(a){var b=a.threadKey,e=a.triggerSource,f=(h||(h=c("useReStore")))(),g=c("useMAWCanThreadBeCutoverOnDemand")(b),j=n(null);a=o(!1);var p=a[0],q=a[1],r=c("useMWNavigation")(),s=c("useMWPThreadPointQueryOneToOneCutoverThreadThenNavigate")();d("Int64Hooks").useEffectInt64(function(){var a=j.current==null||j.current!==g;a&&g&&!c("gkx")("7946")&&(j.current=g,q(!0),c("promiseDone")(d("WALoggerDeferred").LOG(m(),(i||(i=d("I64"))).to_string(b))),c("QPLUserFlow").start(c("qpl")._(1056847893,"505"),{annotations:{bool:{is_non_blocking:!1},string:{entrypoint:e}}}),e==="inbox"?s&&s({contactId:b,isOnDemandCutover:!0,navigationApi:r}):c("LSPlatformWaitForTaskCompletion")(f,function(a){return c("LSThreadPointQueryAndRestoreMessagesWithJIDStoredProcedure")(c("LSFactory")(a),{waJid:b})},"readwrite").then(function(){c("promiseDone")(d("WALoggerDeferred").LOG(l(),(i||(i=d("I64"))).to_string(b))),c("QPLUserFlow").endSuccess(c("qpl")._(1056847893,"505"))})["catch"](function(a){a="[OD-Cutover] Cutover finished with an error for ThreadKey: "+(i||(i=d("I64"))).to_string(b)+".\nError: "+a;c("promiseDone")(d("WALoggerDeferred").LOG(k(),a));c("QPLUserFlow").endFailure(c("qpl")._(1056847893,"505"),a)})["finally"](function(){q(!1)}))},[g,f,r,b,s,e]);return p}g["default"]=a}),98);